var split;var _tempprotocol=document.location.protocol;var _tempport="51559";split=split||function(undef){var nativeSplit=String.prototype.split,compliantExecNpcg=/()??/.exec("")[1]===undef,self;self=function(str,separator,limit){if(Object.prototype.toString.call(separator)!=="[object RegExp]"){return nativeSplit.call(str,separator,limit)}var output=[],flags=(separator.ignoreCase?"i":"")+(separator.multiline?"m":"")+(separator.extended?"x":"")+(separator.sticky?"y":""),lastLastIndex=0,separator=new RegExp(separator.source,flags+"g"),separator2,match,lastIndex,lastLength;str+="";if(!compliantExecNpcg){separator2=new RegExp("^"+separator.source+"$(?!\\s)",flags)}limit=limit===undef?-1>>>0:limit>>>0;while(match=separator.exec(str)){lastIndex=match.index+match[0].length;if(lastIndex>lastLastIndex){output.push(str.slice(lastLastIndex,match.index));if(!compliantExecNpcg&&match.length>1){match[0].replace(separator2,function(){for(var i=1;i<arguments.length-2;i++){if(arguments[i]===undef){match[i]=undef}}})}if(match.length>1&&match.index<str.length){Array.prototype.push.apply(output,match.slice(1))}lastLength=match[0].length;lastLastIndex=lastIndex;if(output.length>=limit){break}}if(separator.lastIndex===match.index){separator.lastIndex++}}if(lastLastIndex===str.length){if(lastLength||!separator.test("")){output.push("")}}else{output.push(str.slice(lastLastIndex))}return output.length>limit?output.slice(0,limit):output};String.prototype.split=function(separator,limit){return self(this,separator,limit)};return self}();var _tempmethod="";var _tempparam1="";var _tempparam2="";var _tempparam3="";var _tempparam4="";var _tempparam5="";function _clearTemp(){_tempmethod="";_tempparam1="";_tempparam2="";_tempparam3="";_tempparam4="";_tempparam5=""}function mCommonUtil(obj){this.obj=obj;this.SAR_OK=0;this.SAR_FALSE=1;this.SGD_SM1_ECB=257;this.SGD_SM1_CBC=258;this.SGD_SM1_CFB=260;this.SGD_SM1_OFB=264;this.SGD_SM1_MAC=272;this.SGD_SSF33_ECB=513;this.SGD_SSF33_CBC=514;this.SGD_SSF33_CFB=516;
this.SGD_SSF33_OFB=520;this.SGD_SSF33_MAC=528;this.SGD_SM4_ECB=1025;this.SGD_SM4_CBC=1026;this.SGD_SM4_CFB=1028;this.SGD_SM4_OFB=1032;this.SGD_SM4_MAC=1040;this.SGD_VENDOR_DEFINED=2147483648;this.SGD_DES_ECB=this.SGD_VENDOR_DEFINED+529;this.SGD_DES_CBC=this.SGD_VENDOR_DEFINED+530;this.SGD_3DES168_ECB=this.SGD_VENDOR_DEFINED+577;this.SGD_3DES168_CBC=this.SGD_VENDOR_DEFINED+578;this.SGD_3DES112_ECB=this.SGD_VENDOR_DEFINED+545;this.SGD_3DES112_CBC=this.SGD_VENDOR_DEFINED+546;this.SGD_AES128_ECB=this.SGD_VENDOR_DEFINED+273;this.SGD_AES128_CBC=this.SGD_VENDOR_DEFINED+274;this.SGD_AES192_ECB=this.SGD_VENDOR_DEFINED+289;this.SGD_AES192_CBC=this.SGD_VENDOR_DEFINED+290;this.SGD_AES256_ECB=this.SGD_VENDOR_DEFINED+321;this.SGD_AES256_CBC=this.SGD_VENDOR_DEFINED+322;this.SGD_RSA=65536;this.SGD_SM2_1=131328;this.SGD_SM2_2=131584;this.SGD_SM2_3=132096;this.SGD_SM3=1;this.SGD_SHA1=2;this.SGD_SHA256=4;this.SGD_RAW=128;this.SGD_MD5=129;this.SGD_SHA384=130;this.SGD_SHA512=131;this.SGD_CERT_VERSION=1;this.SGD_CERT_SERIAL=2;this.SGD_CERT_ISSUE=5;this.SGD_CERT_VALID_TIME=6;this.SGD_CERT_SUBJECT=7;this.SGD_CERT_DER_PUBLIC_KEY=8;this.SGD_CERT_DER_EXTENSIONS=9;this.SGD_CERT_NOT_BEFORE=16;this.SGD_CERT_ISSUER_CN=33;this.SGD_CERT_ISSUER_O=34;this.SGD_CERT_ISSUER_OU=35;this.SGD_CERT_ISSUER_C=36;this.SGD_CERT_ISSUER_P=37;this.SGD_CERT_ISSUER_L=38;this.SGD_CERT_ISSUER_S=39;this.SGD_CERT_ISSUER_EMAIL=40;this.SGD_CERT_SUBJECT_CN=49;this.SGD_CERT_SUBJECT_O=50;this.SGD_CERT_SUBJECT_OU=51;this.SGD_CERT_SUBJECT_EMALL=52;this.SGD_REMAIN_TIME=53;this.SGD_SIGNATURE_ALG=54;this.SGD_CERT_SUBJECT_C=55;this.SGD_CERT_SUBJECT_P=56;this.SGD_CERT_SUBJECT_L=57;this.SGD_CERT_SUBJECT_S=58;this.SGD_CERT_CRL=65;this.SGD_DEVICE_SORT=513;this.SGD_DEVICE_TYPE=514;this.SGD_DEVICE_NAME=515;this.SGD_DEVICE_MANUFACTURER=516;this.SGD_DEVICE_HARDWARE_VERSION=517;this.SGD_DEVICE_SOFTWARE_VERSION=518;this.SGD_DEVICE_STANDARD_VERSION=519;this.SGD_DEVICE_SERIAL_NUMBER=520;this.SGD_DEVICE_SUPPORT_SYM_ALG=521;this.SGD_DEVICE_SUPPORT_ASYM_ALG=522;
this.SGD_DEVICE_SUPPORT_HASH_ALG=523;this.SGD_DEVICE_SUPPORT_STORANGE_SPACE=524;this.SGD_DEVICE_SUPPORT_FREE_SAPCE=525;this.SGD_DEVICE_RUNTIME=526;this.SGD_DEVICE_USED_TIMES=527;this.SGD_DEVICE_LOCATION=528;this.SGD_DEVICE_DESCRIPTION=529;this.SGD_DEVICE_MANAGER_INFO=530;this.SGD_DEVICE_MAX_DATA_SIZE=531;this.TRUE=1;this.FALSE=0;this.GM3000PCSC=0;this.GM3000=1;this.K7=2;this.K5=3;this.TF=4;this.TYPE_UKEY=1;this.TYPE_FPKEY=2;var g_mTokenPlugin=null;var g_deviceNames=null;this.SOF_GetLastError=function(){if(g_mTokenPlugin==null){return -1}return g_mTokenPlugin.SOF_GetLastError()};function isIe(){return("ActiveXObject" in window)}function isMobile(){}this.SOF_LoadLibrary=function(type){var ret;if(g_mTokenPlugin==null){g_mTokenPlugin=new mTokenPlugin()}return this.SAR_OK};this.SOF_EnumDevice=function(){if(g_mTokenPlugin==null){return null}var array=g_mTokenPlugin.SOF_EnumDevice();if(array==null||array.length<=0){return null}return array.split("||")};this.SOF_GetVersion=function(){if(g_mTokenPlugin==null){g_mTokenPlugin=new mTokenPlugin()}return g_mTokenPlugin.SOF_GetVersion()};this.SOF_InitUsbKey=function(dllname){if(g_mTokenPlugin==null){g_mTokenPlugin=new mTokenPlugin()}return g_mTokenPlugin.SOF_InitUsbKey(dllname)};this.SOF_GetDeviceInfo=function(Type){if(g_mTokenPlugin==null){alert("请先调用初始化接口");return null}return g_mTokenPlugin.SOF_GetDeviceInfo(Type)};this.SOF_GetCertInfoEx=function(type,certOid,certType){if(g_mTokenPlugin==null){alert("请先调用初始化接口");return null}return g_mTokenPlugin.SOF_GetCertInfoEx(type,certOid,certType)};this.SOF_SignData=function(data,signflag){if(g_mTokenPlugin==null){alert("请先调用初始化接口");return null}return g_mTokenPlugin.SOF_SignData(data,signflag)};this.SOF_P1SignData=function(data){if(g_mTokenPlugin==null){alert("请先调用初始化接口");return null}return g_mTokenPlugin.SOF_P1SignData(data)};this.SOF_VerifySignedData=function(InData,SignedValue,flag){if(g_mTokenPlugin==null){alert("请先调用初始化接口");return -1}return g_mTokenPlugin.SOF_VerifySignedData(InData,SignedValue,flag)
};this.SOF_VerifyP1SignedData=function(InData,SignedValue,flag){if(g_mTokenPlugin==null){alert("请先调用初始化接口");return -1}return g_mTokenPlugin.SOF_VerifyP1SignedData(InData,SignedValue,flag)};this.SOF_GetCert=function(CertType){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_GetCert(CertType)};this.SOF_GetDeviceInstance=function(DeviceName,ApplicationName){if(g_mTokenPlugin==null){return -1}return g_mTokenPlugin.SOF_GetDeviceInstance(DeviceName,ApplicationName)};this.SOF_GetUserList=function(){if(g_mTokenPlugin==null){return null}var array=g_mTokenPlugin.SOF_GetUserList();if(array==null||array.length<=0){return null}var list=new Array();var user=array.split("&&&");var length=user.length;for(var i=0;i<length;i++){list[i]=user[i].split("||")}return list};this.SOF_Encrpyt=function(inData,Base64Cert){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_Encrpyt(inData,Base64Cert)};this.SOF_Decrypt=function(encData){if(g_mTokenPlugin==null){alert("请先初始化接口");return null}return g_mTokenPlugin.SOF_Decrypt(encData)};this.SOF_ExportUserCert=function(ContainerName,KeySpec){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_ExportUserCert(ContainerName,KeySpec)};this.SOF_GetCertInfo=function(Base64EncodeCert,Type,szOID){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_GetCertInfo(Base64EncodeCert,Type,szOID)};this.SOF_GetCertInfoByOid=function(Base64EncodeCert,OID){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_GetCertInfoByOid(Base64EncodeCert,OID)};this.SOF_Login=function(PassWd){if(g_mTokenPlugin==null){return -1}return g_mTokenPlugin.SOF_Login(PassWd)};this.SOF_Digest=function(content,type){if(g_mTokenPlugin==null){return -1}return g_mTokenPlugin.SOF_Digest(content,type)};this.SOF_DJGetSealData=function(srcData,lEx,lType){if(g_mTokenPlugin==null){return -1}return g_mTokenPlugin.SOF_DJGetSealData(srcData,lEx,lType)};this.SOF_LogOut=function(){if(g_mTokenPlugin==null){return -1}return g_mTokenPlugin.SOF_LogOut()};this.SOF_GetPinRetryCount=function(){if(g_mTokenPlugin==null){return -1
}return g_mTokenPlugin.SOF_GetPinRetryCount()};this.SOF_ChangePassWd=function(OldPassWd,NewPassWd){if(g_mTokenPlugin==null){return -1}return g_mTokenPlugin.SOF_ChangePassWd(OldPassWd,NewPassWd)};this.SOF_SetDigestMethod=function(DigestMethod){if(g_mTokenPlugin==null){return -1}return g_mTokenPlugin.SOF_SetDigestMethod(DigestMethod)};this.SOF_SetUserID=function(UserID){if(g_mTokenPlugin==null){return -1}return g_mTokenPlugin.SOF_SetUserID(UserID)};this.SOF_SetEncryptMethodAndIV=function(EncryptMethod,EncryptIV){if(g_mTokenPlugin==null){return -1}return g_mTokenPlugin.SOF_SetEncryptMethodAndIV(EncryptMethod,EncryptIV)};this.SOF_EncryptFileToPKCS7=function(Cert,InFile,OutFile,type){if(g_mTokenPlugin==null){return -1}return g_mTokenPlugin.SOF_EncryptFileToPKCS7(Cert,InFile,OutFile,type)};this.SOF_SignFileToPKCS7=function(ContainerName,InFile,OutFile){if(g_mTokenPlugin==null){return -1}return g_mTokenPlugin.SOF_SignFileToPKCS7(ContainerName,InFile,OutFile)};this.SOF_VerifyFileToPKCS7=function(strPkcs7Data,InFilePath){if(g_mTokenPlugin==null){return -1}return g_mTokenPlugin.SOF_VerifyFileToPKCS7(strPkcs7Data,InFilePath)};this.SOF_DecryptFileToPKCS7=function(ContainerName,keySpec,Pkcs7Data,InFile,OutFile,type){if(g_mTokenPlugin==null){return -1}return g_mTokenPlugin.SOF_DecryptFileToPKCS7(ContainerName,keySpec,Pkcs7Data,InFile,OutFile,type)};this.SOF_DigestData=function(ContainerName,nData,InDataLen){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_DigestData(ContainerName,nData,InDataLen)};this.SOF_SignDataInteractive=function(ContainerName,ulKeySpec,InData,InDataLen){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_SignDataInteractive(ContainerName,ulKeySpec,InData,InDataLen)};this.SOF_SignDataToPKCS7=function(ContainerName,ulKeySpec,InData,ulDetached){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_SignDataToPKCS7(ContainerName,ulKeySpec,InData,ulDetached)};this.SOF_VerifyDataToPKCS7=function(Base64EncodeCert,InData,SignedValue){if(g_mTokenPlugin==null){return -1
}return g_mTokenPlugin.SOF_VerifyDataToPKCS7(Base64EncodeCert,InData,SignedValue)};this.SOF_EncryptDataPKCS7=function(Base64EncodeCert,InData,InDataLen){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_EncryptDataPKCS7(Base64EncodeCert,InData,InDataLen)};this.SOF_DecryptDataPKCS7=function(ContainerName,ulKeySpec,InData){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_DecryptDataPKCS7(ContainerName,ulKeySpec,InData)};this.SOF_GenRemoteUnblockRequest=function(){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_GenRemoteUnblockRequest()};this.SOF_GenResetpwdResponse=function(request,soPin,userPin){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_GenResetpwdResponse(request,soPin,userPin)};this.SOF_RemoteUnblockPIN=function(request){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_RemoteUnblockPIN(request)};this.SOF_SignDataToPKCS7=function(ContainerName,ulKeySpec,InData,ulDetached){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_SignDataToPKCS7(ContainerName,ulKeySpec,InData,ulDetached)};this.SOF_VerifyDataToPKCS7=function(strPkcs7Data,OriginalText,ulDetached){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_VerifyDataToPKCS7(strPkcs7Data,OriginalText,ulDetached)};this.SOF_ExportPubKey=function(containerName,cerType,expType){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_ExportPubKey(containerName,cerType,expType)};this.SOF_EncryptByPubKey=function(strPubKey,strInput,cerType){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_EncryptByPubKey(strPubKey,strInput,cerType)};this.SOF_DecryptByPrvKey=function(containerName,cerType,strAsymCipher){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_DecryptByPrvKey(containerName,cerType,strAsymCipher)};this.SOF_CreateKeyPair=function(container,keySpec,asymAlg,keyLength){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_CreateKeyPair(container,keySpec,asymAlg,keyLength)};this.SOF_EnumCertContiner=function(){if(g_mTokenPlugin==null){return null
}return g_mTokenPlugin.SOF_EnumCertContiner()};this.SOF_FindContainer=function(certSN){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_FindContainer(certSN)};this.SOF_DeleteCert=function(certSN){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_DeleteCert(certSN)};this.SOF_DeleteContainer=function(certSN){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_DeleteContainer(certSN)};this.SOF_SignByCert=function(certSN,plain){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_SignByCert(certSN,plain)};this.SOF_VerifyByCert=function(certSN,plain,signature){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_VerifyByCert(certSN,plain,signature)};this.SOF_GenerateP10Request=function(container,dn,asymAlg,keySpec,keyLength){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_GenerateP10Request(container,dn,asymAlg,keySpec,keyLength)};this.SOF_ImportCert=function(container,cert,keySpec){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_ImportCert(container,cert,keySpec)};this.SOF_ImportCryptoCertAndKey=function(container,cert,nAsymAlg,EncryptedSessionKeyData,symAlg,EncryptedPrivateKeyData,mode){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_ImportCryptoCertAndKey(container,cert,nAsymAlg,EncryptedSessionKeyData,symAlg,EncryptedPrivateKeyData,mode)};this.SOF_VerifyByExtCert=function(cert,plain,signature,digestMethod){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_VerifyByExtCert(cert,plain,signature,digestMethod)};this.SOF_GenerateRandom=function(length){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_GenerateRandom(length)};this.SOF_SymEncryptFile=function(sessionKey,srcfile,destfile,type){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_SymEncryptFile(sessionKey,srcfile,destfile,type)};this.SOF_SymDecryptFile=function(sessionKey,srcfile,destfile,type){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_SymDecryptFile(sessionKey,srcfile,destfile,type)
};this.SOF_SymEncryptData=function(sessionKey,inData){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_SymEncryptData(sessionKey,inData)};this.SOF_SymDecryptData=function(sessionKey,inData){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_SymDecryptData(sessionKey,inData)};this.SOF_GenerateQRCode=function(qrcode_text){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_GenerateQRCode(qrcode_text)};this.SOF_VerifyPinMS=function(responseKey){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_VerifyPinMS(responseKey)};this.SOF_GetHardwareType=function(){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_GetHardwareType()};this.SOF_VerifyFingerprint=function(){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_VerifyFingerprint()};this.SOF_EnumFiles=function(){if(g_mTokenPlugin==null){return null}var array=g_mTokenPlugin.SOF_EnumFiles();if(array==null||array.length<=0){return null}return array.split("||")};this.SOF_ReadFile=function(fileName,offset,length){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_ReadFile(fileName,Number(offset),Number(length))};this.SOF_WriteFile=function(fileName,offset,data){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_WriteFile(fileName,offset,data)};this.SOF_CreateFile=function(fileName,length,readRight,writeRight){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_CreateFile(fileName,length,readRight,writeRight)};this.SOF_DeleteFile=function(fileName){if(g_mTokenPlugin==null){return null}return g_mTokenPlugin.SOF_DeleteFile(fileName)};this.GetDllName=function(){if(g_mTokenPlugin==null){g_mTokenPlugin=new mTokenPlugin()}return g_mTokenPlugin.GetDllName()};this.SOF_CertAuth=function(srcData,pwd,lType){if(g_mTokenPlugin==null){g_mTokenPlugin=new mTokenPlugin()}return g_mTokenPlugin.SOF_CertAuth(srcData,pwd,lType)};this.SOF_Auth=function(srcData,pwd,lType){var userAgent=navigator.userAgent;var isIEB=userAgent.indexOf("compatible")>-1&&userAgent.indexOf("MSIE")>-1;
var isEdge=userAgent.indexOf("Windows NT 6.1; Trident/7.0;")>-1&&!isIEB;var IEVersion=navigator.userAgent.toLowerCase().match(/msie ([\d.]+)/);var isIE7=false;var isIE8=false;var isIE9=false;if(IEVersion!=null){isIE7=IEVersion[0].indexOf("7")!=-1;isIE8=IEVersion[0].indexOf("8")!=-1;isIE9=IEVersion[0].indexOf("9")!=-1}if(isIE7||isIE8||isIE9||isEdge){var signData;var certpem;var jsonResult='{"authdata":"","certdata":"","retCode":"","retMsg":""}';var obj=eval("("+jsonResult+")");var bRet;try{bRet=CMSSign.setPasswd("P11",pwd,1)}catch(e){obj["retCode"]="-2000";obj["retMsg"]="控件加载失败，请使用非IE浏览器访问";return obj}if(!bRet){var errorMsg=CMSSign.GetLastErrorInfo(0);obj["retCode"]="-2001";obj["retMsg"]=errorMsg;return obj}if(lType=="P1"){bRet=CMSSign.SignEnvelope(srcData);if(bRet){signData=CMSSign.SignedData}else{var errorMsg=CMSSign.GetLastErrorInfo(0);obj["retCode"]="-2002";obj["retMsg"]=errorMsg;return obj}}else{if(lType=="P7"){bRet=CMSSign.Sign(srcData);if(bRet){signData=CMSSign.SignedData}else{var errorMsg=CMSSign.GetLastErrorInfo(0);obj["retCode"]="-2003";obj["retMsg"]=errorMsg;return obj}}else{obj["retCode"]="-99";obj["retMsg"]="请求非法";return obj}}certpem=CMSSign.GetCertEx(2);obj["authdata"]=signData;obj["certdata"]=certpem;obj["retCode"]="0";obj["retMsg"]="成功";return obj}else{if(g_mTokenPlugin==null){g_mTokenPlugin=new mTokenPlugin()}return g_mTokenPlugin.SOF_Auth(srcData,pwd,lType)}}}function mTokenPlugin(){var _curDevName="";var _url=_tempprotocol+"//127.0.0.1:"+_tempport+"/mongoose";var _xmlhttp;function AjaxIO(json){if(_xmlhttp==null){if(window.XMLHttpRequest){_xmlhttp=new XMLHttpRequest()}else{_xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}}_xmlhttp.open("POST",_url,false);_xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");_xmlhttp.send(json)}function GetHttpResult(){if(_xmlhttp.readyState==4&&_xmlhttp.status==200){var retStr=_xmlhttp.responseText;var start=retStr.indexOf("{");var result=retStr.substring(start,retStr.length);var obj=eval("("+result+")");
return obj}else{return null}}this.SOF_GetVersion=function(){var json="label=SOF_GetVersion&a=1&b=2";try{AjaxIO(json)}catch(e){return -3}var ret=GetHttpResult();if(ret){return ret.version}return -2};this.SOF_InitUsbKey=function(dllname){if(dllname!="AHCA"){if(dllname.toUpperCase()=="HT"){dllname="SKFAPI20050.dll"}if(dllname.toUpperCase()=="HS"){dllname="SKF_HD_APP.dll"}if(dllname.toUpperCase()=="FT3003"){dllname="ShuttleCsp11_3003.dll"}if(dllname.toUpperCase()=="FT3000GM"){dllname="ahcaftp11d.dll"}var json="label=SOF_InitUsbKey&dllname="+dllname;try{AjaxIO(json)}catch(e){return -3}var ret=GetHttpResult();if(ret){return ret.retCode}return -2}for(var i=0;i<4;i++){if(i==0){dllname="SKFAPI20050.dll"}if(i==1){dllname="SKF_HD_APP.dll"}if(i==2){dllname="ShuttleCsp11_3003.dll"}if(i==3){dllname="ahcaftp11d.dll"}var json="label=SOF_InitUsbKey&dllname="+dllname;try{AjaxIO(json);var ret=GetHttpResult();if(ret){if(ret.retCode==0){return ret.retCode}}}catch(e){return -3}}return -1002};this.SOF_GetDeviceInfo=function(Type){var json="label=SOF_GetDeviceInfo&devicetip="+Type;try{AjaxIO(json)}catch(e){return -3}var ret=GetHttpResult();if(ret){return ret.keyinfo}return -2};this.SOF_GetCertInfoEx=function(type,certOid,certType){var json="label=SOF_GetCertInfoEx&type="+type+"&certType="+certType;try{AjaxIO(json)}catch(e){return -3}var ret=GetHttpResult();if(ret){if(ret.retCode!=0){return""}return ret.certinfo}return -2};this.SOF_SignData=function(data,signflag){var json="label=SOF_SignData&srcdata="+data+"&signflag="+signflag;try{AjaxIO(json)}catch(e){return -3}var ret=GetHttpResult();if(ret){return ret.signdata}return -2};this.SOF_P1SignData=function(data){var signflag="p1";var json="label=SOF_P1SignData&srcdata="+data+"&signflag="+signflag;try{AjaxIO(json)}catch(e){return -3}var ret=GetHttpResult();if(ret){return ret.signdata}return -2};this.SOF_VerifySignedData=function(InData,SignedValue,flag){var json="label=SOF_VerifySignedData&SignValue="+SignedValue+"&signflag="+flag;alert(json);try{AjaxIO(json)
}catch(e){return -3}var ret=GetHttpResult();if(ret){return ret.retCode}return -2};this.SOF_VerifyP1SignedData=function(InData,SignedValue,flag){var json="label=SOF_VerifyP1SignedData&srcdata="+InData+"&SignValue="+SignedValue+"&signflag="+flag;alert(json);try{AjaxIO(json)}catch(e){return -3}var ret=GetHttpResult();if(ret){return ret.retCode}return -2};this.SOF_GetCert=function(CertType){var json="label=SOF_GetCert&certType="+CertType;try{AjaxIO(json)}catch(e){return -3}var ret=GetHttpResult();if(ret){return ret.certpem}return -2};this.SOF_GetCertInfo=function(Base64EncodeCert,Type,szOID){var json="label=SOF_GetCertInfo&type="+Type+"&certpem="+Base64EncodeCert+"&szExOid="+szOID;try{AjaxIO(json)}catch(e){return -3}var ret=GetHttpResult();var str=JSON.stringify(ret);if(ret){return ret.certinfo}return -2};this.SOF_Encrpyt=function(inData,Base64Cert){var json="label=SOF_Encrpyt&srcdata="+inData+"&certpem="+Base64Cert;alert(json);try{AjaxIO(json)}catch(e){return -3}var ret=GetHttpResult();if(ret){return ret.encData}return -2};this.SOF_Decrypt=function(encData){var json="label=SOF_Decrypt&srcdata="+encData;try{AjaxIO(json)}catch(e){return -3}var ret=GetHttpResult();if(ret){return ret.decData}return -2};this.SOF_Login=function(PassWd){var json="label=SOF_Login&pwd="+PassWd;try{AjaxIO(json)}catch(e){return -3}var ret=GetHttpResult();if(ret){return ret.retCode}return -2};this.SOF_Digest=function(content,type){var json="label=SOF_Digest&srcdata="+content+"&type="+type;try{AjaxIO(json)}catch(e){return -3}var ret=GetHttpResult();if(ret){return ret.digestdata}return -2};this.SOF_DJGetSealData=function(srcData,lEx,lType){var json="label=DJ_GetSignAndSeal&srcdata="+srcData+"&lEx="+lEx+"&type="+lType;alert(json);try{AjaxIO(json)}catch(e){return -3}var ret=GetHttpResult();if(ret){return ret.sealImg}return -2};this.GetDllName=function(){var returnDllname=-1002;for(var i=0;i<4;i++){if(i==0){dllname="SKFAPI20050.dll"}if(i==1){dllname="SKF_HD_APP.dll"}if(i==2){dllname="ShuttleCsp11_3003.dll"
}if(i==3){dllname="ahcaftp11d.dll"}var json="label=SOF_InitUsbKey&dllname="+dllname;try{AjaxIO(json);var ret=GetHttpResult();var str=JSON.stringify(ret);if(ret){if(ret.retCode==0){returnDllname=dllname;break}}}catch(e){}}return returnDllname};this.SOF_CertAuth=function(srcData,pwd,lType){var json="label=SOF_CertAuth&Srcdata="+srcData+"&Pwd="+pwd+"&AuthType="+lType;try{AjaxIO(json)}catch(e){return -3}var ret=GetHttpResult();if(ret){return ret}return -2};this.SOF_Auth=function(srcData,pwd,lType){var json="label=SOF_Auth&Srcdata="+srcData+"&Pwd="+pwd+"&AuthType="+lType;try{AjaxIO(json)}catch(e){return -3}var ret=GetHttpResult();if(ret){return ret}return -2}}var _xmlhttp2;var _XDR=null;function AjaxIO(_url,json,callback){if(window.XMLHttpRequest){_xmlhttp2=new XMLHttpRequest()}else{_xmlhttp2=new ActiveXObject("Microsoft.XMLHTTP")}_xmlhttp2.onreadystatechange=callback;_xmlhttp2.open("POST",_url,true);_xmlhttp2.setRequestHeader("Content-type","application/x-www-form-urlencoded");_xmlhttp2.send(json)}function AjaxIO_YB(json,callback){var _curDevName="";var _url;if(_temp_zjj_url!=null){_url=_temp_zjj_url}else{_url=_tempprotocol+"//127.0.0.1:"+_tempport+"/mongoose"}if(window.XDomainRequest){_XDR=new XDomainRequest();try{_XDR.open("POST",_url);_XDR.timeout=10000;_XDR.onload=callback;_XDR.ontimeout=callback;_XDR.onerror=callback;_XDR.send(json)}catch(e){callback()}}else{if(_xmlhttp2==null||_xmlhttp2==undefined||_xmlhttp2.readyState==0){if(window.XMLHttpRequest){_xmlhttp2=new XMLHttpRequest()}else{_xmlhttp2=new ActiveXObject("Microsoft.XMLHTTP")}_xmlhttp2.onreadystatechange=callback;_xmlhttp2.open("POST",_url,true);_xmlhttp2.timeout=10000;_xmlhttp2.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");_xmlhttp2.send(json)}}}function isLowerIe(){var userAgent=navigator.userAgent;var isIEB=userAgent.indexOf("compatible")>-1&&userAgent.indexOf("MSIE")>-1;var IEVersion=navigator.userAgent.toLowerCase().match(/msie ([\d.]+)/);var isIE7=false;var isIE8=false;
var isIE9=false;var isIE10=false;if(IEVersion!=null){isIE7=IEVersion[0].indexOf("7")!=-1;isIE8=IEVersion[0].indexOf("8")!=-1;isIE9=IEVersion[0].indexOf("9")!=-1;isIE10=IEVersion[0].indexOf("10")!=-1}return isIE7||isIE8||isIE9||isIE10}function _CACMSSign(){if(isLowerIe()){try{if(_tempmethod=="SOF_Auth_YB"){var signData;var certpem;var jsonResult='{"authdata":"","certdata":"","retCode":"","retMsg":""}';var obj=eval("("+jsonResult+")");var bRet=CMSSign.setPasswd("P11",_tempparam2,1);if(!bRet){var errorMsg=CMSSign.GetLastErrorInfo(0);obj["retCode"]="-2001";obj["retMsg"]=errorMsg;_clearTemp();return obj}if(_tempparam3=="P1"){bRet=CMSSign.SignEnvelope(_tempparam1);if(bRet){signData=CMSSign.SignedData}else{var errorMsg=CMSSign.GetLastErrorInfo(0);obj["retCode"]="-2002";obj["retMsg"]=errorMsg;_clearTemp();return obj}}else{if(_tempparam3=="P7"){bRet=CMSSign.Sign(_tempparam2);if(bRet){signData=CMSSign.SignedData}else{var errorMsg=CMSSign.GetLastErrorInfo(0);obj["retCode"]="-2003";obj["retMsg"]=errorMsg;_clearTemp();return obj}}else{bRet=CMSSignNotExist.clearpasswd()}}certpem=CMSSign.GetCertEx(2);obj["authdata"]=signData;obj["certdata"]=certpem;obj["retCode"]="0";obj["retMsg"]="成功";_clearTemp();return obj}else{if(_tempmethod=="SOF_SignAdvance"){var signData;var jsonResult='{"authdata":"","retCode":"","retMsg":""}';var obj=eval("("+jsonResult+")");var bRet=CMSSign.setPasswd("P11",_tempparam2,1);if(!bRet){var errorMsg=CMSSign.GetLastErrorInfo(0);obj["retCode"]="-2001";obj["retMsg"]=errorMsg;_clearTemp();return obj}if(_tempparam3=="P1"){bRet=CMSSign.SignEnvelope(_tempparam1);if(bRet){signData=CMSSign.SignedData}else{var errorMsg=CMSSign.GetLastErrorInfo(0);obj["retCode"]="-2002";obj["retMsg"]=errorMsg;_clearTemp();return obj}}else{if(_tempparam3=="P7"){bRet=CMSSign.Sign(_tempparam2);if(bRet){signData=CMSSign.SignedData}else{var errorMsg=CMSSign.GetLastErrorInfo(0);obj["retCode"]="-2003";obj["retMsg"]=errorMsg;_clearTemp();return obj}}else{bRet=CMSSignNotExist.clearpasswd()}}obj["authdata"]=signData;
obj["retCode"]="0";obj["retMsg"]="成功";_clearTemp();return obj}else{if(_tempmethod=="SOF_Encrpyt"){var signData;var jsonResult='{"authdata":"","retCode":"","retMsg":""}';var obj=eval("("+jsonResult+")");var bRet=CMSSign.setPasswd("P11",_tempparam2,1);if(!bRet){var errorMsg=CMSSign.GetLastErrorInfo(0);obj["retCode"]="-2001";obj["retMsg"]=errorMsg;_clearTemp();return obj}if(_tempparam3=="P1"){bRet=CMSSign.SignEnvelope(_tempparam1);if(bRet){signData=CMSSign.SignedData}else{var errorMsg=CMSSign.GetLastErrorInfo(0);obj["retCode"]="-2002";obj["retMsg"]=errorMsg;_clearTemp();return obj}}else{if(_tempparam3=="P7"){bRet=CMSSign.Sign(_tempparam2);if(bRet){signData=CMSSign.SignedData}else{var errorMsg=CMSSign.GetLastErrorInfo(0);obj["retCode"]="-2003";obj["retMsg"]=errorMsg;_clearTemp();return obj}}else{bRet=CMSSignNotExist.clearpasswd()}}obj["authdata"]=signData;obj["retCode"]="0";obj["retMsg"]="成功";_clearTemp();return obj}}}}catch(e){}}return null}function getAjaxResult(){if(_XDR!=null){var retStr=_XDR.responseText;if(retStr==""){var _CACMSSignResult=_CACMSSign();if(_CACMSSignResult!=null){return _CACMSSignResult}var errorMsg='{"retCode":"","retMsg":""}';var obj=eval("("+errorMsg+")");obj["retCode"]="-3";obj["retMsg"]="驱动服务加载异常，请安装或重新打开助手后使用";_XDR=null;_clearTemp();return obj}var start=retStr.indexOf("{");var result=retStr.substring(start,retStr.length);var end=result.indexOf("}");var result2=result.substring(0,(end+1));var obj=eval("("+result2+")");_XDR=null;_clearTemp();return obj}else{if(_xmlhttp2.readyState==4){if(_xmlhttp2.status==200){var retStr=_xmlhttp2.responseText;var start=retStr.indexOf("{");var result=retStr.substring(start,retStr.length);var end=result.indexOf("}");var result2=result.substring(0,(end+1));var obj=eval("("+result2+")");_xmlhttp2=null;_clearTemp();return obj}else{var errorMsg='{"retCode":"","retMsg":""}';var obj=eval("("+errorMsg+")");obj["retCode"]="-3";obj["retMsg"]="驱动服务加载异常，请安装或重新打开助手后使用";_xmlhttp2=null;_clearTemp();return obj}}else{_clearTemp();
return null}}}function createParams(method,param1,param2,param3,param4,param5){if(isLowerIe()){if(_tempmethod!=""){return}_tempmethod=method;_tempparam1=param1;_tempparam2=param2;_tempparam3=param3;_tempparam4=param4;_tempparam5=param5}var json="";if(method=="SOF_Auth_YB"){json="label=SOF_Auth&Pwd="+param2+"&AuthType="+param3+"&Srcdata="+param1}else{if(method=="SOF_AuthPlus"){json="label=SOF_AuthUp&Pwd="+param2+"&AuthType="+param3+"&SerData="+param4+"&Srcdata="+param1}else{if(method=="getVersion"){json="label=SOF_GetVersion&a=1&b=2"}else{if(method=="SOF_SignAdvance"){json="label=SOF_SignAdvance&Pwd="+param2+"&AuthType="+param3+"&Srcdata="+param1}else{if(method=="SOF_SignAfterLogin"){json="label=SOF_SignAfterLogin&AuthType="+param1+"&Src="+param2}else{if(method=="SOF_GetSealData"){json="label=SOF_GetSealData&SealType=0"}else{if(method=="SOF_GetCertInfoA"){json="label=SOF_GetCertInfoA&certtype="+param1}else{if(method=="SOF_GetUkeyInfoEx"){json="label=SOF_GetUkeyInfoEx&Srcdata=1"}else{if(method=="SOF_GetCertAndSeal"){json="label=SOF_GetCertAndSeal&certtype="+param1+"&sealType=0&keyin="+param2}else{if(method=="SOF_Encrpyt"){json="label=SOF_Encrpyt&certpem="+param2+"&srcdata="+param1}else{if(method=="SOF_Decrypt"){json="label=SOF_DecryptEx&Passwd="+param1+"&EncData="+param2}else{if(method=="SOF_ECCDecryptEx"){json="label=SOF_ECCDecryptEx&Passwd="+param1+"&EncData="+param2}else{if(method=="SOF_BatchSign"){json="label=SOF_BatchSign&BatchData="+param2+"&SignNum="+param1+"&AuthType="+param3}else{if(method=="SOF_QuickSign"){json="label=SOF_QuickSign&BatchData="+param2+"&SignNum="+param1+"&AuthType=P1"}else{if(method=="SOF_GetKeyList"){json="label=SOF_GetKeyList&KeyType=Haitai20050"}else{if(method=="SOF_SignBySelectKey"){json="label=SOF_SignByCert&Srcdata="+param1+"&KeyName="+param2+"&Passwd="+param3}}}}}}}}}}}}}}}}return json}if(isLowerIe()){document.write("<object classid='CLSID:2B92874C-DCA6-4641-AEA5-BAEDE459B41C' id='CMSSign' width='0' style='display: none;' height='0' ></object>")
}var _XDR_TEMP;var _xmlhttp2_TEMP;function _temp_check(callback){var _url;if(_temp_zjj_url!=null){_url=_temp_zjj_url}else{_url=_tempprotocol+"//127.0.0.1:"+_tempport+"/mongoose"}if(window.XDomainRequest){_XDR_TEMP=new XDomainRequest();try{_XDR_TEMP.open("POST",_url);_XDR_TEMP.timeout=400;_XDR_TEMP.onload=callback;_XDR_TEMP.ontimeout=callback;_XDR_TEMP.onerror=callback;_XDR_TEMP.send("label=SOF_GetVersion&a=1&b=2")}catch(e){callback()}}else{if(_xmlhttp2_TEMP==null||_xmlhttp2_TEMP==undefined||_xmlhttp2_TEMP.readyState==0){if(window.XMLHttpRequest){_xmlhttp2_TEMP=new XMLHttpRequest()}else{_xmlhttp2_TEMP=new ActiveXObject("Microsoft.XMLHTTP")}try{_xmlhttp2_TEMP.onreadystatechange=callback;_xmlhttp2_TEMP.open("POST",_url,true);_xmlhttp2_TEMP.timeout=400;_xmlhttp2_TEMP.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");_xmlhttp2_TEMP.send("label=SOF_GetVersion&a=1&b=2")}catch(e){}}}}function _temp_check_getresult(){if(_XDR_TEMP!=null){var retStr=_XDR_TEMP.responseText;if(retStr==""){_XDR_TEMP=null;return false}}else{if(_xmlhttp2_TEMP.readyState==4){if(_xmlhttp2_TEMP.status!=200){_xmlhttp2_TEMP=null;return false}}}return true}var _temp_zjj_url="http://127.0.0.1:51559/mongoose";_temp_check(function(){if(!_temp_check_getresult()){if(_tempprotocol=="http:"){_temp_zjj_url=null;_tempport="51560";_temp_check(function(){if(!_temp_check_getresult()){_tempport="51561";_temp_check(function(){})}})}else{if(_tempprotocol=="https:"){_temp_zjj_url=null;_tempport="51660";_temp_check(function(){if(!_temp_check_getresult()){_tempport="51661";_temp_check(function(){if(!_temp_check_getresult()){_tempport="51662";_temp_check(function(){})}})}})}}}});
